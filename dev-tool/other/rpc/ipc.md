# IPC

IPC（Inter-Process Communication）就是为了解决单主机上多进程之间的通信问题而诞生的一种古老技术。

常用进程间通信技术:

* 管道（Pipe）及有名管道（named pipe）

    管道可用于具有亲缘关系的进程间的通信，有名管道克服了管道没有名称的限制，因此，除了有管道所具有的功能，它还允许无亲缘关系进程间的通信。由于管道存在只能承载无格式字节流及缓冲区大小受限等缺点，所以使用管道进行IPC通信的做法已经不太普遍。

* 套接字（Socket）

    Socket如果用于本地进程间的通信，则要比普通的TCP/IP快很多，这也是一种比较通用的进程间通信的方式。

* 共享内存

    将文件映射到内存中，多个进程通过共享文件的方式使得多个进程可以访问同一块内存空间，这是最快的IPC形式。

管道用作IPC通信时，有以下缺点:

* 只支持单向数据流（双向通信就需要两个管道）
* 匿名管道的缓冲区是有限的
* 管道所传送的是无格式的字节流，这就要求管道的读出方和写入方必须事先约定好数据的格式，比如多少字节算作一个消息（或命令、记录），等等。

Socket API原本是为网络通信设计的，但后来在Socket的框架上发展出一种IPC机制，就是UNIX Domain Socket。UNIXDomain Socket也提供面向流和面向数据包两种API接口，类似于TCP和UDP。虽然普通的TCP Socket也可用于同一台主机的进程间通信（通过loopback地址127.0.0.1），但UNIX DomainSocket在同一台主机上的传输速度是TCP Socket的两倍，这是因为UNIX Domain Socket不需要经过网络协议栈，不需要打包拆包、计算校验和、维护序号和应答等，只是将应用层的数据从一个进程复制到另一个进程，所以速度更快。

采用共享内存通信的一个显而易见的好处是效率高，因为进程可以直接读写内存，而不需要任何数据的复制。对于像管道和套接字这种方式，需要在内核和用户空间进行4次数据复制，共享内存则只复制两次数据：一次从输入文件到共享内存区；另一次从共享内存区到输出文件。实际上，进程之间在共享内存时始终保持共享区域，直到通信完毕。这样，数据的内容一直被保存在共享内存中，并没有写回文件。共享内存中的内容往往是在解除映射时才写回文件的。因此，采用共享内存通信方式的效率是非常高的。

目前主流的做法是通过mmap()实现共享内存，当多个程序调用mmap()映射到同一个文件时，它们实际访问的必然是同一个共享内存区域对应的物理页面。