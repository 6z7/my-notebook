# Redis持久化

Redis提供不同的持久化选择:

* RDB 通过指定的时间间隔，在某个时间点对数据进行快照
* AOF 收到的每个写操作都写到aof日志中，在重启时用于恢复数据。写命令以Redis协议的文本方式追加保存，当数据最后大时会在后台进行重写操作
* 可以完全禁用持久化功能
* 可以同时使用AOF和RDB进行持久化。重启时，由于AOF数据更完整，优先使用AOF重建数据

理解RDB和AOF的区别是很重要的，先从RDB开始。

## RDB优势

* RDB是一个非常紧凑的某个时间点的数据库文件。RDB非常适合归档备份。
* RDB非常适合灾难恢复，可以被传输到远端的数据中心
* RDB最大限度地提高了Redis的性能，因为Redis父进程要持久化，唯一需要做的工作就是派生一个子进程来完成其余的工作。父进程永远不会执行磁盘I/O操作或类似的操作。
* 对于大量数据，RDB比APF重启更快

## RDB缺点

* 当Redis停止工作时，想最小化数据丢失，RDB不是一个很好的选择
* 为了持久化RDB需要经常fork()，如果数据很大，fork()可能会耗时很长，造成阻塞。AOF也是用fork(),但是可以调整重写的频率，同时不会对数据持久产生任何影响

## AOF优势

* 可以有不同的同步策略：不手动同步、每秒手动同步一次和每次操作后同步。默认策略是每秒同步一次，最多会丢失1秒的写数据
* AOF是一个只追加的文件，如果文件有损坏，可以通过redis-check-aof工具修复
* 当AOF文件的大小到达阀值，会自动在后台重写。重写移除中间操作生成一个最小化的新的文件，当新的文件准备好后，redis将切换到新文件，写数据到新文件中。
* 

